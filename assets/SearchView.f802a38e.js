import{m as A,q as k,t as B,y as te,v as e,z as S,P as W,Q as X,r as y,c as Z,w as le,k as I,B as g,u as o,G as c,j as D,$ as L,a0 as T,S as se,I as ie,A as ne}from"./@vue.e6301bd2.js";import{u as oe}from"./vue-router.f815959e.js";import{_ as ee,e as H,d as ae,B as E,t as G,f as J,h as de,u as ue,a as re}from"./index.e209341e.js";import{_ as O}from"./Select.vue_vue_type_style_index_0_lang.49107d85.js";import{_ as P}from"./DateTime.vue_vue_type_script_setup_true_lang.fec6fc5e.js";import{d as h}from"./dayjs.386643b6.js";import{u as Q}from"./useLimitSelect.3bb9345f.js";import{_ as ce,a as ve}from"./BillItem.vue_vue_type_script_setup_true_lang.61b6474f.js";import{o as me}from"./lodash-es.4471eccc.js";import"./dexie.a92c4e2b.js";import"./uuid.fbc3d34b.js";import"./@vueuse.ec86b252.js";import"./vue-i18n.ac4c776b.js";import"./@intlify.cff06da3.js";import"./complex.js.3b936b7b.js";const fe=t=>(W("data-v-914c42f6"),t=t(),X(),t),_e={class:"clearable flex items-center"},ye=fe(()=>e("i",{class:"icon-close icon-xs opacity-30"},null,-1)),xe=[ye],pe=A({__name:"Clearable",props:{visible:{type:Boolean}},emits:["clear"],setup(t){return(_,v)=>(k(),B("div",_e,[te(_.$slots,"default",{},void 0,!0),e("div",{class:S(["close buttoned rounded-full",{visible:t.visible}]),onClick:v[0]||(v[0]=m=>_.$emit("clear"))},xe,2)]))}});const R=ee(pe,[["__scopeId","data-v-914c42f6"]]),he=t=>{var b,V,M,u,r,d;const _=y(t!=null&&t.start?h(t==null?void 0:t.start):h.unix(-1/0)),v=y(t!=null&&t.end?h(t==null?void 0:t.end):h.unix(1/0)),m=y((b=t==null?void 0:t.min)!=null?b:-1/0),f=y((V=t==null?void 0:t.max)!=null?V:1/0),x=y(t==null?void 0:t.type),{allUsers:p}=ae(),$=y((u=(M=t==null?void 0:t.users)==null?void 0:M.map(l=>p.value.find(i=>i.id===l)).filter(Boolean))!=null?u:[]);Q($,p);const a=y((d=(r=t==null?void 0:t.categories)==null?void 0:r.map(l=>H.find(i=>i.id===l)))!=null?d:[]),w=Z(()=>H.filter(l=>x.value===void 0||l.type===x.value));return Q(a,w),le(x,()=>{a.value=[...w.value]}),{start:_,end:v,min:m,max:f,type:x,selectedUsers:$,selectedCategories:a,allUsers:p,billCategories:w,reset:()=>{_.value=h.unix(-1/0),v.value=h.unix(1/0),m.value=-1/0,f.value=1/0,x.value=void 0,$.value=p.value,a.value=[...w.value]},getFilter:()=>{var l,i;return{start:(l=_.value)!=null&&l.isValid()?_.value:void 0,end:(i=v.value)!=null&&i.isValid()?v.value:void 0,max:f.value,min:m.value,type:x.value,users:$.value.map(s=>s.id),categories:a.value.map(s=>s.id)}},setFilter:l=>{var i,s,n,U,z,K;_.value=l!=null&&l.start?h(l==null?void 0:l.start):h.unix(-1/0),v.value=l!=null&&l.end?h(l==null?void 0:l.end):h.unix(1/0),f.value=(i=l==null?void 0:l.max)!=null?i:1/0,m.value=(s=l==null?void 0:l.min)!=null?s:-1/0,x.value=l.type,$.value=(U=(n=l==null?void 0:l.users)==null?void 0:n.map(N=>p.value.find(q=>q.id===N)).filter(Boolean))!=null?U:[],a.value=(K=(z=l==null?void 0:l.categories)==null?void 0:z.map(N=>H.find(q=>q.id===N)))!=null?K:[]}}},Y=t=>(W("data-v-21dc2670"),t=t(),X(),t),$e={class:"pt-4 pb-2"},we={class:"flex justify-between py-2"},be={class:"flex-1 flex justify-between"},ge={class:"flex"},Ie={class:"flex justify-between py-2"},ke={class:"flex items-center px-2"},Ce=Y(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-align-middle icon-xs"})],-1)),Ve={class:"px-2"},Be={class:"flex rounded-full shadow overflow-hidden"},je={class:"flex justify-between py-2"},Fe={class:"flex items-center px-2"},Se=Y(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-credit-card icon-xs"})],-1)),Ue={class:"px-2 whitespace-nowrap"},Me={class:"flex"},De={class:"rounded-full shadow px-2 buttoned mx-2 flex items-center"},Ye=Y(()=>e("div",{class:"px-2"},"-",-1)),Re={class:"rounded-full shadow px-2 buttoned mx-2"},Ee={class:"flex justify-between py-2"},ze={class:"flex items-center px-2"},Ne=Y(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-user-list icon-xs"})],-1)),qe={class:"px-2"},He={class:"flex"},Le={class:"shadow buttoned px-4 max-w-[160px] rounded-full h-full truncate mx-2 py-1"},Te={class:"flex justify-between py-2"},Ae={class:"flex items-center px-2"},Ke=Y(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-carousel icon-xs"})],-1)),Ge={class:"px-2"},Je={class:"flex"},Oe={class:"shadow buttoned px-4 max-w-[160px] rounded-full h-full truncate mx-2 py-1"},Pe={class:"w-8 flex justify-center"},Qe={class:"mx-2"},We=Y(()=>e("div",null,[e("i",{class:"icon-play-list-search"})],-1)),Xe={class:"px-2"},Ze=A({__name:"BillFilter",props:{filter:null},emits:["update:modelValue"],setup(t,{expose:_,emit:v}){const m=t,f=y(Boolean(m.filter)),x=i=>{if(i!==void 0){f.value=i;return}f.value=!f.value},p=i=>i.isValid()?i.format("YYYY-MM-DD"):G("early"),$=i=>i.isValid()?i.format("YYYY-MM-DD"):G("later"),{start:a,end:w,min:C,max:j,type:F,selectedUsers:b,selectedCategories:V,allUsers:M,billCategories:u,getFilter:r,setFilter:d,reset:l}=he(m.filter);return _({getFilter:r,setFilter:d,toggleExpand:x}),(i,s)=>(k(),B("div",$e,[e("div",{class:S(["filter-field transition-all rounded",[f.value?"h-[252px] opacity-100":"h-0 overflow-hidden opacity-0"]])},[e("div",we,[e("div",be,[e("div",ge,[I(R,{visible:!0,class:"rounded-full shadow px-2 buttoned truncate py-2",onClear:s[1]||(s[1]=n=>a.value=o(h).unix(-1/0))},{default:g(()=>[I(P,{modelValue:o(a),"onUpdate:modelValue":s[0]||(s[0]=n=>D(a)?a.value=n:null),"display-formatter":p},{icon:g(()=>[e("div",null,c(i.$t("from"))+":",1)]),_:1},8,["modelValue"])]),_:1})]),e("div",null,[I(R,{visible:!0,class:"rounded-full shadow px-2 buttoned truncate py-2",onClear:s[3]||(s[3]=n=>w.value=o(h).unix(1/0))},{default:g(()=>[I(P,{modelValue:o(w),"onUpdate:modelValue":s[2]||(s[2]=n=>D(w)?w.value=n:null),"display-formatter":$},{icon:g(()=>[e("div",null,c(i.$t("to"))+":",1)]),_:1},8,["modelValue"])]),_:1})])])]),e("div",Ie,[e("div",ke,[Ce,e("div",Ve,c(i.$t("type"))+":",1)]),e("div",Be,[e("div",{class:S(["w-80px text-center buttoned py-1",{"!bg-stone-700 !text-white":o(F)===o(E).Income}]),onClick:s[4]||(s[4]=n=>F.value=o(E).Income)},c(i.$t("income")),3),e("div",{class:S(["w-80px text-center buttoned py-1",{"!bg-stone-700 !text-white":o(F)===o(E).Expenses}]),onClick:s[5]||(s[5]=n=>F.value=o(E).Expenses)},c(i.$t("expenses")),3),e("div",{class:S(["w-80px text-center buttoned py-1",{"!bg-stone-700 !text-white":o(F)===void 0}]),onClick:s[6]||(s[6]=n=>F.value=void 0)},c(i.$t("all")),3)])]),e("div",je,[e("div",Fe,[Se,e("div",Ue,c(i.$t("range"))+":",1)]),e("div",Me,[e("div",De,[I(R,{visible:!0,onClear:s[9]||(s[9]=n=>C.value=-1/0)},{default:g(()=>[o(C)!==-1/0?L((k(),B("input",{key:0,"onUpdate:modelValue":s[7]||(s[7]=n=>D(C)?C.value=n:null),type:"number",class:"max-w-50px bg-transparent focus:border-none focus:outline-none text-right py-1",inputmode:"decimal"},null,512)),[[T,o(C)]]):(k(),B("div",{key:1,class:"py-1",onClick:s[8]||(s[8]=n=>C.value=0)},c(i.$t("unlimited")),1))]),_:1})]),Ye,e("div",Re,[I(R,{visible:!0,onClear:s[12]||(s[12]=n=>j.value=1/0)},{default:g(()=>[o(j)!==1/0?L((k(),B("input",{key:0,"onUpdate:modelValue":s[10]||(s[10]=n=>D(j)?j.value=n:null),type:"number",class:"max-w-50px bg-transparent focus:border-none focus:outline-none text-right py-1",inputmode:"decimal"},null,512)),[[T,o(j)]]):(k(),B("div",{key:1,class:"py-1",onClick:s[11]||(s[11]=n=>j.value=0)},c(i.$t("unlimited")),1))]),_:1})])])]),e("div",Ee,[e("div",ze,[Ne,e("div",qe,c(i.$t("users"))+":",1)]),e("div",He,[I(O,{modelValue:o(b),"onUpdate:modelValue":s[13]||(s[13]=n=>D(b)?b.value=n:null),list:o(M),multiple:"","value-key":"id"},{default:g(({allSelected:n})=>[e("div",Le,c(n?i.$t("all"):o(b).length===0?"None":o(b).map(U=>U.name).join(",")),1)]),_:1},8,["modelValue","list"])])]),e("div",Te,[e("div",Ae,[Ke,e("div",Ge,c(i.$t("categories"))+":",1)]),e("div",Je,[I(O,{modelValue:o(V),"onUpdate:modelValue":s[14]||(s[14]=n=>D(V)?V.value=n:null),list:o(u),multiple:"","value-key":"id"},{default:g(({allSelected:n})=>[e("div",Oe,c(n?i.$t("all"):o(V).length===0?i.$t("none"):o(V).map(U=>i.$t(U.name)).join(",")),1)]),option:g(({item:n,selected:U,select:z})=>[e("div",{class:S(["p-2 buttoned flex items-center",{"!bg-gray-700 text-white":U}])},[e("div",Pe,[e("i",{class:S([n.icon])},null,2)]),e("div",Qe,c(i.$t(n.name)),1)],2)]),_:1},8,["modelValue","list"])])])],2),e("div",{class:S(["flex justify-between py-2",{"border-t":f.value}])},[e("div",null,[e("div",{class:S(["buttoned rounded-sm px-2 text-gray-600",{"opacity-0 pointer-events-none":!f.value}]),onClick:s[15]||(s[15]=(...n)=>o(l)&&o(l)(...n))},c(i.$t("reset")),3)]),e("div",{class:"flex items-center rounded-sm buttoned px-2",onClick:s[16]||(s[16]=()=>x())},[We,e("div",Xe,c(i.$t("filter")),1)])],2)]))}});const et=ee(Ze,[["__scopeId","data-v-21dc2670"]]),tt=()=>{const t=y(`comp_${J()}`);return{key:t,reload:()=>{t.value=`comp_${J()}`}}},lt={class:"w-full h-full flex justify-center p-2"},st={class:"h-full w-full mx-2 max-w-[600px] flex flex-col"},it={class:"search w-full flex justify-center pt-4"},nt={class:"w-full h-10 shadow-md rounded-sm flex items-center px-4 focus-within:shadow-lg"},ot={class:"flex-1"},at=e("i",{class:"icon-search"},null,-1),dt=[at],ut={class:"flex-1 flex flex-col overflow-hidden"},rt={class:"flex items-center justify-between px-2"},ct={class:"text-sm text-gray-500"},vt={key:0,class:"icon-sort-az opacity-40"},mt={key:1,class:"icon-sort-za"},ft={key:2,class:"icon-sort-az"},_t={class:"flex-1 divide-y overflow-y-auto"},St=A({__name:"SearchView",setup(t){const{list:_}=ue(),v=y(""),m=y([]),f=oe(),x=()=>f.query.filters?JSON.parse(f.query.filters):void 0,p=y(),$=[void 0,"asc","desc"],a=y(),w=()=>{const u=$.findIndex(d=>d===a.value),r=u+1>=$.length?0:u+1;a.value=$[r]},C=Z(()=>a.value===void 0?m.value:me(m.value,["money"],[a.value])),{key:j,reload:F}=tt(),b=()=>{var d;const u=(d=p.value)==null?void 0:d.getFilter();if(!u){m.value=[];return}const r=u;F(),m.value=_.value.filter(l=>de(l,{...r,comment:v.value}))};se(()=>{var r,d;const u=x();u&&((r=p.value)==null||r.setFilter(u),(d=p.value)==null||d.toggleExpand(!0),b())});const V=(u,r)=>{const i=Math.min(m.value.length,u+r)-u;return 72*i},{show:M}=re();return(u,r)=>(k(),B("div",lt,[e("div",st,[e("div",it,[e("div",nt,[e("div",ot,[I(R,{visible:v.value.length>0,onClear:r[1]||(r[1]=d=>v.value="")},{default:g(()=>[L(e("input",{"onUpdate:modelValue":r[0]||(r[0]=d=>v.value=d),type:"text",class:"w-full bg-transparent focus:border-none focus:outline-none"},null,512),[[T,v.value]])]),_:1},8,["visible"])]),e("div",{class:"buttoned p-3 rounded-full",onClick:b},dt)])]),e("div",ut,[I(et,{ref_key:"filterRef",ref:p},null,512),e("div",rt,[e("div",ct,c(u.$t("total"))+": "+c(o(C).length),1),e("div",{onClick:w,class:"px-4 py-2 buttoned rounded-full"},[a.value===void 0?(k(),B("div",vt)):a.value==="asc"?(k(),B("div",mt)):a.value==="desc"?(k(),B("div",ft)):ie("",!0)])]),e("div",_t,[(k(),ne(ce,{key:o(j),list:o(C),"value-key":"id","get-range-height":V,"footer-height":96},{default:g(({item:d})=>[I(ve,{bill:d,onClick:l=>o(M)(d)},null,8,["bill","onClick"])]),_:1},8,["list"]))])])])]))}});export{St as default};
