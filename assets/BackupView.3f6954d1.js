import{n as w,k as g,o as i,M as p,m as h,q as x,F as B}from"./index.c996f72d.js";import{c as k}from"./cancelablePromise.8984d70f.js";import{u as C}from"./@vueuse.9aab9800.js";import{d as f}from"./dayjs.8eec1a0d.js";import{e as E,i as M}from"./dexie-export-import.af7d5a11.js";import{r as y,m as R,c as T,q as D,t as Y,v as c,G as b,u as d,k as I,B as P}from"./@vue.aa17ec7c.js";import"./vue-router.835b731e.js";import"./dexie.a92c4e2b.js";import"./uuid.fbc3d34b.js";import"./vue-i18n.bcf46dc7.js";import"./@intlify.03657722.js";const V=(t,s)=>{const e=document.createElement("a");e.target="_blank",e.download=t,e.href=URL.createObjectURL(s),e.click()},m=C("lastBackupTime",-1),H=()=>{const t=y(0),{start:s,cancel:e}=k(async l=>{let o=!1;l(()=>{o=!0,t.value=0}),t.value=0;const n=await E(w,{progressCallback:a=>o?!1:(a.totalRows&&(t.value=a.completedRows/a.totalRows),!0)});m.value=f().unix(),V(`oncent-backup-${f().format("YYYY-MM-DD HH:mm:ss")}.json`,n)});return{start:s,cancel:e,progress:t}},S=()=>{const t=y(0),{start:s,cancel:e}=k(async(l,o)=>{let n=!1;l(()=>{n=!0,t.value=0}),t.value=0,await M(w,o,{acceptVersionDiff:!0,acceptMissingTables:!0,acceptChangedPrimaryKey:!0,clearTablesBeforeImport:!0,acceptNameDiff:!1,overwriteValues:!0,progressCallback:a=>n?!1:(a.totalRows&&(t.value=a.completedRows/a.totalRows),!0)})});return{start:s,cancel:e,progress:t}},j={class:"flex flex-col"},F=c("div",{class:"p-2 text-[red]"}," Warning: This is a beta feature that may not fully tested yet, please do not clear your data for no reason! ",-1),L={class:"p-2"},N={class:"py-2 text-sm"},U=["disabled"],te=R({__name:"BackupView",setup(t){const s=T(()=>m.value===-1?"not backup yet":f.unix(m.value).format("YYYY-MM-DD HH:mm:ss")),e=y(!1),{progress:l,start:o,cancel:n}=H(),a=async()=>{e.value=!0;try{await o(),i({content:"Export success",type:p.Success})}catch(r){i({content:r==null?void 0:r.message,type:p.Error})}e.value=!1},{progress:q,start:v,cancel:A}=S(),_=async()=>{await h({title:"This will replace all your current data, please make sure you have your data backup."});const[r]=await x({accept:B});e.value=!0;try{await v(r),i({content:"Import data success",type:p.Success})}catch(u){i({content:u==null?void 0:u.message,type:p.Error})}e.value=!1};return(r,u)=>(D(),Y("div",j,[F,c("div",L,[c("div",N,"last backup: "+b(d(s)),1),c("button",{class:"my-2 w-full shadow bg-stone-900 text-white py-2 rounded",onClick:a}," start backup "),c("button",{class:"my-2 w-full shadow buttoned py-2 rounded",disabled:d(m)<0,onClick:_}," start import ",8,U)]),I(g,{visible:e.value},{default:P(()=>[c("div",null,"exporting:"+b(d(l)),1)]),_:1},8,["visible"])]))}});export{te as default};
