import{m as A,q as V,t as j,y as ee,v as e,z as F,P as Z,Q as K,r as $,c as W,w as te,k as h,B as g,u as o,G as c,j as D,Z as T,_ as L,$ as le,I as se}from"./@vue.97c6951d.js";import{u as ie}from"./vue-router.f889bb8d.js";import{_ as X,e as H,d as ne,B as R,t as J,f as oe,u as ae,a as de}from"./index.f6ac297b.js";import{_ as O}from"./Select.vue_vue_type_style_index_0_lang.3e7f384b.js";import{_ as P}from"./DateTime.vue_vue_type_script_setup_true_lang.87a1d40e.js";import{d as p}from"./dayjs.386643b6.js";import{u as Q}from"./useLimitSelect.9f8388a4.js";import{_ as ue,a as re}from"./BillItem.vue_vue_type_script_setup_true_lang.330db851.js";import{o as ce}from"./lodash-es.4471eccc.js";import"./dexie.a92c4e2b.js";import"./uuid.fbc3d34b.js";import"./@vueuse.5aff771e.js";import"./vue-i18n.ac1798c5.js";import"./@intlify.cff06da3.js";import"./complex.js.3b936b7b.js";const ve=l=>(Z("data-v-914c42f6"),l=l(),K(),l),me={class:"clearable flex items-center"},fe=ve(()=>e("i",{class:"icon-close icon-xs opacity-30"},null,-1)),_e=[fe],xe=A({__name:"Clearable",props:{visible:{type:Boolean}},emits:["clear"],setup(l){return(_,v)=>(V(),j("div",me,[ee(_.$slots,"default",{},void 0,!0),e("div",{class:F(["close buttoned rounded-full",{visible:l.visible}]),onClick:v[0]||(v[0]=m=>_.$emit("clear"))},_e,2)]))}});const E=X(xe,[["__scopeId","data-v-914c42f6"]]),ye=l=>{var k,a,r,u,S,M;const _=$(l!=null&&l.start?p(l==null?void 0:l.start):p.unix(-1/0)),v=$(l!=null&&l.end?p(l==null?void 0:l.end):p.unix(1/0)),m=$((k=l==null?void 0:l.min)!=null?k:-1/0),f=$((a=l==null?void 0:l.max)!=null?a:1/0),x=$(l==null?void 0:l.type),{allUsers:y}=ne(),w=$((u=(r=l==null?void 0:l.users)==null?void 0:r.map(s=>y.value.find(i=>i.id===s)).filter(Boolean))!=null?u:[]);Q(w,y);const d=$((M=(S=l==null?void 0:l.categories)==null?void 0:S.map(s=>H.find(i=>i.id===s)))!=null?M:[]),b=W(()=>H.filter(s=>x.value===void 0||s.type===x.value));return Q(d,b),te(x,()=>{d.value=[...b.value]}),{start:_,end:v,min:m,max:f,type:x,selectedUsers:w,selectedCategories:d,allUsers:y,billCategories:b,reset:()=>{_.value=p.unix(-1/0),v.value=p.unix(1/0),m.value=-1/0,f.value=1/0,x.value=void 0,w.value=y.value,d.value=[...b.value]},getFilter:()=>{var s,i;return{start:(s=_.value)!=null&&s.isValid()?_.value:void 0,end:(i=v.value)!=null&&i.isValid()?v.value:void 0,max:f.value,min:m.value,type:x.value,users:w.value.map(t=>t.id),categories:d.value.map(t=>t.id)}},setFilter:s=>{var i,t,n,U,z,G;_.value=s!=null&&s.start?p(s==null?void 0:s.start):p.unix(-1/0),v.value=s!=null&&s.end?p(s==null?void 0:s.end):p.unix(1/0),f.value=(i=s==null?void 0:s.max)!=null?i:1/0,m.value=(t=s==null?void 0:s.min)!=null?t:-1/0,x.value=s.type,w.value=(U=(n=s==null?void 0:s.users)==null?void 0:n.map(N=>y.value.find(q=>q.id===N)).filter(Boolean))!=null?U:[],d.value=(G=(z=s==null?void 0:s.categories)==null?void 0:z.map(N=>H.find(q=>q.id===N)))!=null?G:[]}}},Y=l=>(Z("data-v-21dc2670"),l=l(),K(),l),pe={class:"pt-4 pb-2"},he={class:"flex justify-between py-2"},$e={class:"flex-1 flex justify-between"},we={class:"flex"},be={class:"flex justify-between py-2"},ge={class:"flex items-center px-2"},Ce=Y(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-align-middle icon-xs"})],-1)),Ie={class:"px-2"},ke={class:"flex rounded-full shadow overflow-hidden"},Ve={class:"flex justify-between py-2"},je={class:"flex items-center px-2"},Be=Y(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-credit-card icon-xs"})],-1)),Fe={class:"px-2 whitespace-nowrap"},Se={class:"flex"},Ue={class:"rounded-full shadow px-2 buttoned mx-2 flex items-center"},Me=Y(()=>e("div",{class:"px-2"},"-",-1)),De={class:"rounded-full shadow px-2 buttoned mx-2"},Ye={class:"flex justify-between py-2"},Ee={class:"flex items-center px-2"},Re=Y(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-user-list icon-xs"})],-1)),ze={class:"px-2"},Ne={class:"flex"},qe={class:"shadow buttoned px-4 max-w-[160px] rounded-full h-full truncate mx-2 py-1"},He={class:"flex justify-between py-2"},Te={class:"flex items-center px-2"},Le=Y(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-carousel icon-xs"})],-1)),Ae={class:"px-2"},Ge={class:"flex"},Je={class:"shadow buttoned px-4 max-w-[160px] rounded-full h-full truncate mx-2 py-1"},Oe={class:"w-8 flex justify-center"},Pe={class:"mx-2"},Qe=Y(()=>e("div",null,[e("i",{class:"icon-play-list-search"})],-1)),Ze={class:"px-2"},Ke=A({__name:"BillFilter",props:{filter:null},emits:["update:modelValue"],setup(l,{expose:_,emit:v}){const m=l,f=$(Boolean(m.filter)),x=i=>{if(i!==void 0){f.value=i;return}f.value=!f.value},y=i=>i.isValid()?i.format("YYYY-MM-DD"):J("early"),w=i=>i.isValid()?i.format("YYYY-MM-DD"):J("later"),{start:d,end:b,min:C,max:I,type:B,selectedUsers:k,selectedCategories:a,allUsers:r,billCategories:u,getFilter:S,setFilter:M,reset:s}=ye(m.filter);return _({getFilter:S,setFilter:M,toggleExpand:x}),(i,t)=>(V(),j("div",pe,[e("div",{class:F(["filter-field transition-all rounded",[f.value?"h-[252px] opacity-100":"h-0 overflow-hidden opacity-0"]])},[e("div",he,[e("div",$e,[e("div",we,[h(E,{visible:!0,class:"rounded-full shadow px-2 buttoned truncate py-2",onClear:t[1]||(t[1]=n=>d.value=o(p).unix(-1/0))},{default:g(()=>[h(P,{modelValue:o(d),"onUpdate:modelValue":t[0]||(t[0]=n=>D(d)?d.value=n:null),"display-formatter":y},{icon:g(()=>[e("div",null,c(i.$t("from"))+":",1)]),_:1},8,["modelValue"])]),_:1})]),e("div",null,[h(E,{visible:!0,class:"rounded-full shadow px-2 buttoned truncate py-2",onClear:t[3]||(t[3]=n=>b.value=o(p).unix(1/0))},{default:g(()=>[h(P,{modelValue:o(b),"onUpdate:modelValue":t[2]||(t[2]=n=>D(b)?b.value=n:null),"display-formatter":w},{icon:g(()=>[e("div",null,c(i.$t("to"))+":",1)]),_:1},8,["modelValue"])]),_:1})])])]),e("div",be,[e("div",ge,[Ce,e("div",Ie,c(i.$t("type"))+":",1)]),e("div",ke,[e("div",{class:F(["w-80px text-center buttoned py-1",{"!bg-stone-700 !text-white":o(B)===o(R).Income}]),onClick:t[4]||(t[4]=n=>B.value=o(R).Income)},c(i.$t("income")),3),e("div",{class:F(["w-80px text-center buttoned py-1",{"!bg-stone-700 !text-white":o(B)===o(R).Expenses}]),onClick:t[5]||(t[5]=n=>B.value=o(R).Expenses)},c(i.$t("expenses")),3),e("div",{class:F(["w-80px text-center buttoned py-1",{"!bg-stone-700 !text-white":o(B)===void 0}]),onClick:t[6]||(t[6]=n=>B.value=void 0)},c(i.$t("all")),3)])]),e("div",Ve,[e("div",je,[Be,e("div",Fe,c(i.$t("range"))+":",1)]),e("div",Se,[e("div",Ue,[h(E,{visible:!0,onClear:t[9]||(t[9]=n=>C.value=-1/0)},{default:g(()=>[o(C)!==-1/0?T((V(),j("input",{key:0,"onUpdate:modelValue":t[7]||(t[7]=n=>D(C)?C.value=n:null),type:"number",class:"max-w-50px bg-transparent focus:border-none focus:outline-none text-right py-1",inputmode:"decimal"},null,512)),[[L,o(C)]]):(V(),j("div",{key:1,class:"py-1",onClick:t[8]||(t[8]=n=>C.value=0)},c(i.$t("unlimited")),1))]),_:1})]),Me,e("div",De,[h(E,{visible:!0,onClear:t[12]||(t[12]=n=>I.value=1/0)},{default:g(()=>[o(I)!==1/0?T((V(),j("input",{key:0,"onUpdate:modelValue":t[10]||(t[10]=n=>D(I)?I.value=n:null),type:"number",class:"max-w-50px bg-transparent focus:border-none focus:outline-none text-right py-1",inputmode:"decimal"},null,512)),[[L,o(I)]]):(V(),j("div",{key:1,class:"py-1",onClick:t[11]||(t[11]=n=>I.value=0)},c(i.$t("unlimited")),1))]),_:1})])])]),e("div",Ye,[e("div",Ee,[Re,e("div",ze,c(i.$t("users"))+":",1)]),e("div",Ne,[h(O,{modelValue:o(k),"onUpdate:modelValue":t[13]||(t[13]=n=>D(k)?k.value=n:null),list:o(r),multiple:"","value-key":"id"},{default:g(({allSelected:n})=>[e("div",qe,c(n?i.$t("all"):o(k).length===0?"None":o(k).map(U=>U.name).join(",")),1)]),_:1},8,["modelValue","list"])])]),e("div",He,[e("div",Te,[Le,e("div",Ae,c(i.$t("categories"))+":",1)]),e("div",Ge,[h(O,{modelValue:o(a),"onUpdate:modelValue":t[14]||(t[14]=n=>D(a)?a.value=n:null),list:o(u),multiple:"","value-key":"id"},{default:g(({allSelected:n})=>[e("div",Je,c(n?i.$t("all"):o(a).length===0?i.$t("none"):o(a).map(U=>i.$t(U.name)).join(",")),1)]),option:g(({item:n,selected:U,select:z})=>[e("div",{class:F(["p-2 buttoned flex items-center",{"!bg-gray-700 text-white":U}])},[e("div",Oe,[e("i",{class:F([n.icon])},null,2)]),e("div",Pe,c(i.$t(n.name)),1)],2)]),_:1},8,["modelValue","list"])])])],2),e("div",{class:F(["flex justify-between py-2",{"border-t":f.value}])},[e("div",null,[e("div",{class:F(["buttoned rounded-sm px-2 text-gray-600",{"opacity-0 pointer-events-none":!f.value}]),onClick:t[15]||(t[15]=(...n)=>o(s)&&o(s)(...n))},c(i.$t("reset")),3)]),e("div",{class:"flex items-center rounded-sm buttoned px-2",onClick:t[16]||(t[16]=()=>x())},[Qe,e("div",Ze,c(i.$t("filter")),1)])],2)]))}});const We=X(Ke,[["__scopeId","data-v-21dc2670"]]),Xe={class:"w-full h-full flex justify-center p-2"},et={class:"h-full w-full mx-2 max-w-[600px] flex flex-col"},tt={class:"search w-full flex justify-center pt-4"},lt={class:"w-full h-10 shadow-md rounded-sm flex items-center px-4 focus-within:shadow-lg"},st={class:"flex-1"},it=e("i",{class:"icon-search"},null,-1),nt=[it],ot={class:"flex-1 flex flex-col overflow-hidden"},at={class:"flex items-center justify-between px-2"},dt={class:"text-sm text-gray-500"},ut={key:0,class:"icon-sort-az opacity-40"},rt={key:1,class:"icon-sort-za"},ct={key:2,class:"icon-sort-az"},vt={class:"flex-1 divide-y overflow-y-auto"},jt=A({__name:"SearchView",setup(l){const{list:_}=ae(),v=$(""),m=$([]),f=ie(),x=()=>f.query.filters?JSON.parse(f.query.filters):void 0,y=$(),w=[void 0,"asc","desc"],d=$(),b=()=>{const a=w.findIndex(u=>u===d.value),r=a+1>=w.length?0:a+1;d.value=w[r]},C=W(()=>d.value===void 0?m.value:ce(m.value,["money"],[d.value])),I=()=>{var u;const a=(u=y.value)==null?void 0:u.getFilter();if(!a){m.value=[];return}const r=a;m.value=_.value.filter(S=>oe(S,{...r,comment:v.value}))};le(()=>{var r,u;const a=x();a&&((r=y.value)==null||r.setFilter(a),(u=y.value)==null||u.toggleExpand(!0),I())});const B=(a,r)=>{const M=Math.min(m.value.length,a+r)-a;return 72*M},{show:k}=de();return(a,r)=>(V(),j("div",Xe,[e("div",et,[e("div",tt,[e("div",lt,[e("div",st,[h(E,{visible:v.value.length>0,onClear:r[1]||(r[1]=u=>v.value="")},{default:g(()=>[T(e("input",{"onUpdate:modelValue":r[0]||(r[0]=u=>v.value=u),type:"text",class:"w-full bg-transparent focus:border-none focus:outline-none"},null,512),[[L,v.value]])]),_:1},8,["visible"])]),e("div",{class:"buttoned p-3 rounded-full",onClick:I},nt)])]),e("div",ot,[h(We,{ref_key:"filterRef",ref:y},null,512),e("div",at,[e("div",dt,c(a.$t("total"))+": "+c(o(C).length),1),e("div",{onClick:b,class:"px-4 py-2 buttoned rounded-full"},[d.value===void 0?(V(),j("div",ut)):d.value==="asc"?(V(),j("div",rt)):d.value==="desc"?(V(),j("div",ct)):se("",!0)])]),e("div",vt,[h(ue,{list:o(C),"value-key":"id","get-range-height":B,"footer-height":96},{default:g(({item:u})=>[h(re,{bill:u,onClick:S=>o(k)(u)},null,8,["bill","onClick"])]),_:1},8,["list"])])])])]))}});export{jt as default};
