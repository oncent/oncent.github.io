import{t as _}from"./lodash-es.94cbcf30.js";import{m as H,r as d,J as K,c as S,o as T,R as $,q as g,t as v,F as B,E as P,y as h,M as k,N as L,u as m,S as M,v as w,G as z}from"./@vue.aa17ec7c.js";const q=H({__name:"List",props:{list:null,valueKey:null,loading:{type:Boolean},getRangeHeight:null,remain:{default:20},footerHeight:{default:0}},emits:["reachEnd"],setup(y){const t=y,E=(e,n)=>t.valueKey===void 0?n:typeof t.valueKey=="function"?t.valueKey(e,n):e[t.valueKey],x=()=>{const e=[];return Array.from({length:Math.ceil(t.list.length/t.remain)},()=>0).forEach((n,r)=>{e.push([(r+1)*t.remain,t.getRangeHeight(r*t.remain+0,t.remain)])}),e},a=d([]);K(()=>{a.value=x()});const I=e=>a.value.findIndex((r,s)=>{const l=(()=>s===0?0:a.value.slice(0,s).reduce((u,R)=>u+R[1],0))();return l<e&&l+r[1]>=e}),i=d(-1),c=S(()=>{const e=a.value.reduce((l,u)=>l+u[1],0)+t.footerHeight;if(i.value<2)return{startIndex:0,list:t.list.slice(0,t.remain*3),style:`padding-top:${0}px; height:${e}px`};const n=a.value[i.value-2][0],r=Math.min(t.list.length,n+t.remain*3),s=a.value.slice(0,i.value-1).reduce((l,u)=>l+u[1],0);return{startIndex:n,list:t.list.slice(n,r),style:`padding-top:${s}px; height:${e}px`}}),f=e=>c.value.startIndex+e,o=d(),p=_(e=>{const n=e.target;if(!n||!o.value)return;const r=o.value.offsetTop-n.offsetTop,s=n.scrollTop-r;i.value=I(s)},50);return T(()=>{var e,n;(n=(e=o.value)==null?void 0:e.parentElement)==null||n.addEventListener("scroll",p),$(()=>{var r,s;(s=(r=o.value)==null?void 0:r.parentElement)==null||s.removeEventListener("scroll",p)})}),(e,n)=>(g(),v("div",{style:M(m(c).style),class:"list-view overflow-hidden",ref_key:"listEl",ref:o},[(g(!0),v(B,null,P(m(c).list,(r,s)=>h(e.$slots,"default",k(L({key:E(r,f(s))},{item:r,index:f(s)})),()=>[w("div",null,z(r),1)])),128)),h(e.$slots,"footer")],4))}});export{q as _};
