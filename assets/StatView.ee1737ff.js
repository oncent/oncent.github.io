import{d as o}from"./dayjs.8eec1a0d.js";import{_ as V}from"./DateTime.vue_vue_type_script_setup_true_lang.5226095e.js";import{m as O,r as f,c as Y,o as E,w as C,J as I,q as h,t as x,v as p,z as b,G as k,F as B,E as R,u as M,k as S,P as A,Q as U,n as z,R as N,U as q}from"./@vue.aa17ec7c.js";import{_ as F,i as L,u as G,c as J,B as P,t as Q}from"./index.9689020f.js";import{a as W}from"./@vueuse.9aab9800.js";import{u as Z,i as H,a as K,b as X,c as ee,d as te,e as se,f as ae,g as ne,h as oe,j as le,k as re,l as ie}from"./echarts.f6f9045b.js";import"./vue-router.835b731e.js";import"./dexie.a92c4e2b.js";import"./uuid.fbc3d34b.js";import"./vue-i18n.bcf46dc7.js";import"./@intlify.03657722.js";import"./zrender.271abeed.js";const ue=m=>(A("data-v-6e457e67"),m=m(),U(),m),ce={class:"flex flex-col items-center"},de={class:"flex justify-around rounded-full items-center max-w-300px w-full"},me=["onClick"],fe={key:1,class:"flex justify-around items-center w-full h-12"},pe=ue(()=>p("div",null,"-",-1)),ve=O({__name:"DateRangeSelector",props:{start:{default:o().format("YYYY-MM-DD")},end:{default:o().format("YYYY-MM-DD")},date:null,initialType:{default:"month"}},emits:["change"],setup(m,{emit:c}){const l=m,w=()=>{const n=o(l.start).startOf("year"),t=o(l.end).startOf("year"),e=n.year(),u=t.year();return{type:"year",times:Array.from({length:u-e+1},(_,g)=>({name:`${e+g}`,range:[o(`${e+g}`),o(`${e+g}`).endOf("year")]}))}},d=()=>{const n=o(l.end).startOf("month"),t=o(l.start).startOf("month"),e=n.diff(t,"month")+1,u=Array.from({length:e},(_,g)=>{const j=t.add(g,"month");return{name:j.format("YYYY-MM"),range:[j,j.endOf("month")]}});return{type:"month",times:u}},a=f(l.initialType),v=Y(()=>a.value==="year"?w().times:a.value==="month"?d().times:[{name:"",range:[o(l.start),o(l.end)]}]),D=f(),T=n=>{var u;const t=o(n),e=[...v.value].reverse().findIndex(_=>t.isAfter(_.range[0]));return{index:e,time:(u=v.value[e])!=null?u:v.value[0]}},$=f(),s=f(o(l.start)),i=f(o(l.end)),r=()=>{const{index:n,time:t}=T(s.value);y(t,n,!1)};E(()=>{r()}),C(a,n=>{n!=="custom"&&z(()=>{r()})});const y=(n,t,e=!0)=>{var u;$.value=n,D.value&&((u=document.querySelector(`.slider-item-${t}`))==null||u.scrollIntoView({block:"center",inline:"center",behavior:e?"smooth":void 0})),c("change",...$.value.range)};return I(()=>{s.value&&i.value&&c("change",s.value,i.value)}),(n,t)=>(h(),x("div",ce,[p("div",de,[p("div",{class:b(["flex-1 flex justify-center m-1",{"bg-stone-400 rounded-full text-white":a.value==="year"}]),onClick:t[0]||(t[0]=e=>a.value="year")},k(n.$t("year")),3),p("div",{class:b(["flex-1 flex justify-center m-1",{"bg-stone-400 rounded-full text-white":a.value==="month"}]),onClick:t[1]||(t[1]=e=>a.value="month")},k(n.$t("month")),3),p("div",{class:b(["flex-1 flex justify-center m-1",{"bg-stone-400 rounded-full text-white":a.value==="custom"}]),onClick:t[2]||(t[2]=e=>a.value="custom")},k(n.$t("custom")),3)]),a.value!=="custom"?(h(),x("div",{class:"slider w-full h-12 flex justify-center items-center overflow-x-scroll snap snap-always snap-mandatory snap-x",key:a.value,ref_key:"sliderEl",ref:D},[(h(!0),x(B,null,R(M(v),(e,u)=>{var _;return h(),x("div",{key:e.name,class:b(["whitespace-nowrap mx-2 px-2 rounded-sm snap-center text-sm",[{"bg-stone-700 text-white":e.name===((_=$.value)==null?void 0:_.name)},`slider-item-${u}`]]),onClick:g=>y(e,u)},k(e.name),11,me)}),128))])):(h(),x("div",fe,[S(V,{modelValue:s.value,"onUpdate:modelValue":t[3]||(t[3]=e=>s.value=e),"display-formatter":"YYYY-MM-DD",class:"text-sm buttoned rounded px-2"},null,8,["modelValue"]),pe,S(V,{modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=e=>i.value=e),"display-formatter":"YYYY-MM-DD",class:"text-sm buttoned rounded px-2"},null,8,["modelValue"])]))]))}});const ye=F(ve,[["__scopeId","data-v-6e457e67"]]);Z([H,K,X,ee,te,se,ae,ne,oe,le,re]);const he=O({__name:"Chart",props:{option:null},setup(m){const c=m,l=f(),{width:w}=W();return E(()=>{const d=ie(l.value);d.setOption(c.option),C(()=>c.option,()=>{d.setOption(c.option)}),N(()=>{d.dispose()}),C(w,()=>{d.resize()})}),(d,a)=>(h(),x("div",{ref_key:"chartRef",ref:l},null,512))}}),xe={class:"w-full h-full flex justify-center"},_e={class:"h-full w-full mx-2 max-w-[600px] flex flex-col"},ge={class:"filter w-full m-1 p-2"},we={class:"w-full flex flex-col items-center"},Ie=O({__name:"StatView",setup(m){const{list:c}=G(),l=Y(()=>{const s=c.value.at(-1);if(s)return o.unix(s.time)}),w=Y(()=>{const s=c.value.at(0);if(s)return o.unix(s.time)}),d=s=>{const i=Object.fromEntries(J.filter(({type:r})=>r===P.Expenses).map(r=>[r.id,{total:0,name:Q(r.name)}]));return s.forEach(r=>{i[r.categoryId]&&(i[r.categoryId].total=i[r.categoryId].total+r.money)}),Object.entries(i).filter(([r,{total:y}])=>y!==0).map(([r,y])=>({category:y.name,...y}))},a=f(),v=f(),D=(s,i)=>{a.value=s,v.value=i},T=Y(()=>d(c.value.filter(s=>L(s,a.value,v.value)))),$=Y(()=>({dataset:{dimensions:["category","total"],source:q(T.value)},xAxis:{type:"category",show:!1},yAxis:{},series:[{type:"pie",radius:["50%","70%"],stillShowZeroSum:!1}]}));return(s,i)=>(h(),x("div",xe,[p("div",_e,[p("div",ge,[S(ye,{start:M(l),end:M(w),onChange:D},null,8,["start","end"])]),p("div",we,[S(he,{option:M($),class:"w-full aspect-square max-h-300px"},null,8,["option"])])])]))}});export{Ie as default};
