import{m as K,q as k,t as j,y as te,v as e,z as S,P as W,Q as X,r as x,d as Z,k as I,B as C,u as o,G as r,j as Y,$ as L,a0 as A,S as se,I as le,A as ie}from"./@vue.4058792e.js";import{u as ne}from"./vue-router.fb15f89e.js";import{_ as ee,e as H,d as oe,B as z,t as G,f as J,h as ae,u as de,a as ue}from"./index.f4b89682.js";import{_ as O}from"./Select.vue_vue_type_style_index_0_lang.7b3a1ee2.js";import{_ as P}from"./DateTime.vue_vue_type_script_setup_true_lang.5b996069.js";import{d as h}from"./dayjs.386643b6.js";import{u as Q}from"./useLimitSelect.8881ae61.js";import{_ as ce,a as re}from"./BillItem.vue_vue_type_script_setup_true_lang.1769ef86.js";import{o as ve}from"./lodash-es.4471eccc.js";import"./dexie.a92c4e2b.js";import"./uuid.fbc3d34b.js";import"./@vueuse.0eb3a410.js";import"./vue-i18n.5e152601.js";import"./@intlify.02a09968.js";import"./complex.js.3b936b7b.js";const me=t=>(W("data-v-914c42f6"),t=t(),X(),t),fe={class:"clearable flex items-center"},ye=me(()=>e("i",{class:"icon-close icon-xs opacity-30"},null,-1)),_e=[ye],xe=K({__name:"Clearable",props:{visible:{type:Boolean}},emits:["clear"],setup(t){return(_,v)=>(k(),j("div",fe,[te(_.$slots,"default",{},void 0,!0),e("div",{class:S(["close buttoned rounded-full",{visible:t.visible}]),onClick:v[0]||(v[0]=f=>_.$emit("clear"))},_e,2)]))}});const E=ee(xe,[["__scopeId","data-v-914c42f6"]]),pe=t=>{var w,g,D,a,c,d;const _=x(t!=null&&t.start?h(t==null?void 0:t.start):h.unix(-1/0)),v=x(t!=null&&t.end?h(t==null?void 0:t.end):h.unix(1/0)),f=x((w=t==null?void 0:t.min)!=null?w:-1/0),y=x((g=t==null?void 0:t.max)!=null?g:1/0),$=x(t==null?void 0:t.type),{allUsers:p}=oe(),b=x((a=(D=t==null?void 0:t.users)==null?void 0:D.map(s=>p.value.find(m=>m.id===s)).filter(Boolean))!=null?a:[]);Q(b,p);const u=x((d=(c=t==null?void 0:t.categories)==null?void 0:c.map(s=>H.find(m=>m.id===s)))!=null?d:[]),V=Z(()=>H.filter(s=>$.value===void 0||s.type===$.value));return Q(u,V),{start:_,end:v,min:f,max:y,type:$,selectedUsers:b,selectedCategories:u,allUsers:p,billCategories:V,reset:()=>{_.value=h.unix(-1/0),v.value=h.unix(1/0),f.value=-1/0,y.value=1/0,$.value=void 0,b.value=p.value,u.value=[...V.value]},getFilter:()=>{var s,m;return{start:(s=_.value)!=null&&s.isValid()?_.value:void 0,end:(m=v.value)!=null&&m.isValid()?v.value:void 0,max:y.value,min:f.value,type:$.value,users:b.value.map(i=>i.id),categories:u.value.map(i=>i.id)}},setFilter:s=>{var m,i,l,n,U,N;_.value=s!=null&&s.start?h(s==null?void 0:s.start):h.unix(-1/0),v.value=s!=null&&s.end?h(s==null?void 0:s.end):h.unix(1/0),y.value=(m=s==null?void 0:s.max)!=null?m:1/0,f.value=(i=s==null?void 0:s.min)!=null?i:-1/0,$.value=s.type,b.value=(n=(l=s==null?void 0:s.users)==null?void 0:l.map(q=>p.value.find(T=>T.id===q)).filter(Boolean))!=null?n:[],u.value=(N=(U=s==null?void 0:s.categories)==null?void 0:U.map(q=>H.find(T=>T.id===q)))!=null?N:[]}}},R=t=>(W("data-v-ca4c50d6"),t=t(),X(),t),he={class:"pt-4 pb-2"},$e={class:"flex justify-between py-2"},be={class:"flex-1 flex justify-between"},we={class:"flex"},ge={class:"flex justify-between py-2"},Ce={class:"flex items-center px-2"},Ie=R(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-align-middle icon-xs"})],-1)),ke={class:"px-2"},Ve={class:"flex rounded-full shadow overflow-hidden"},Be={class:"flex justify-between py-2"},je={class:"flex items-center px-2"},Fe=R(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-credit-card icon-xs"})],-1)),Se={class:"px-2 whitespace-nowrap"},Ue={class:"flex"},Me={class:"rounded-full shadow px-2 buttoned mx-2 flex items-center"},De=R(()=>e("div",{class:"px-2"},"-",-1)),Ye={class:"rounded-full shadow px-2 buttoned mx-2"},Re={class:"flex justify-between py-2"},Ee={class:"flex items-center px-2"},ze=R(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-user-list icon-xs"})],-1)),Ne={class:"px-2"},qe={class:"flex"},Te={class:"shadow buttoned px-4 max-w-[160px] rounded-full h-full truncate mx-2 py-1"},He={class:"flex justify-between py-2"},Le={class:"flex items-center px-2"},Ae=R(()=>e("div",{class:"w-6 flex justify-center"},[e("i",{class:"icon-carousel icon-xs"})],-1)),Ke={class:"px-2"},Ge={class:"flex"},Je={class:"shadow buttoned px-4 max-w-[160px] rounded-full h-full truncate mx-2 py-1"},Oe={class:"w-8 flex justify-center"},Pe={class:"mx-2"},Qe=R(()=>e("div",null,[e("i",{class:"icon-play-list-search"})],-1)),We={class:"px-2"},Xe=K({__name:"BillFilter",props:{filter:null},emits:["update:modelValue"],setup(t,{expose:_,emit:v}){const f=t,y=x(Boolean(f.filter)),$=i=>{if(i!==void 0){y.value=i;return}y.value=!y.value},p=i=>i.isValid()?i.format("YYYY-MM-DD"):G("early"),b=i=>i.isValid()?i.format("YYYY-MM-DD"):G("later"),{start:u,end:V,min:B,max:F,type:M,selectedUsers:w,selectedCategories:g,allUsers:D,billCategories:a,getFilter:c,setFilter:d,reset:s}=pe(f.filter),m=i=>{M.value=i,g.value=[...a.value]};return _({getFilter:c,setFilter:d,toggleExpand:$}),(i,l)=>(k(),j("div",he,[e("div",{class:S(["filter-field transition-all rounded",[y.value?"h-[252px] opacity-100":"h-0 overflow-hidden opacity-0"]])},[e("div",$e,[e("div",be,[e("div",we,[I(E,{visible:!0,class:"rounded-full shadow px-2 buttoned truncate py-2",onClear:l[1]||(l[1]=n=>u.value=o(h).unix(-1/0))},{default:C(()=>[I(P,{modelValue:o(u),"onUpdate:modelValue":l[0]||(l[0]=n=>Y(u)?u.value=n:null),"display-formatter":p},{icon:C(()=>[e("div",null,r(i.$t("from"))+":",1)]),_:1},8,["modelValue"])]),_:1})]),e("div",null,[I(E,{visible:!0,class:"rounded-full shadow px-2 buttoned truncate py-2",onClear:l[3]||(l[3]=n=>V.value=o(h).unix(1/0))},{default:C(()=>[I(P,{modelValue:o(V),"onUpdate:modelValue":l[2]||(l[2]=n=>Y(V)?V.value=n:null),"display-formatter":b},{icon:C(()=>[e("div",null,r(i.$t("to"))+":",1)]),_:1},8,["modelValue"])]),_:1})])])]),e("div",ge,[e("div",Ce,[Ie,e("div",ke,r(i.$t("type"))+":",1)]),e("div",Ve,[e("div",{class:S(["w-80px text-center buttoned py-1",{"!bg-stone-700 !text-white":o(M)===o(z).Income}]),onClick:l[4]||(l[4]=n=>m(o(z).Income))},r(i.$t("income")),3),e("div",{class:S(["w-80px text-center buttoned py-1",{"!bg-stone-700 !text-white":o(M)===o(z).Expenses}]),onClick:l[5]||(l[5]=n=>m(o(z).Expenses))},r(i.$t("expenses")),3),e("div",{class:S(["w-80px text-center buttoned py-1",{"!bg-stone-700 !text-white":o(M)===void 0}]),onClick:l[6]||(l[6]=n=>m(void 0))},r(i.$t("all")),3)])]),e("div",Be,[e("div",je,[Fe,e("div",Se,r(i.$t("range"))+":",1)]),e("div",Ue,[e("div",Me,[I(E,{visible:!0,onClear:l[9]||(l[9]=n=>B.value=-1/0)},{default:C(()=>[o(B)!==-1/0?L((k(),j("input",{key:0,"onUpdate:modelValue":l[7]||(l[7]=n=>Y(B)?B.value=n:null),type:"number",class:"max-w-50px bg-transparent focus:border-none focus:outline-none text-right py-1",inputmode:"decimal"},null,512)),[[A,o(B)]]):(k(),j("div",{key:1,class:"py-1",onClick:l[8]||(l[8]=n=>B.value=0)},r(i.$t("unlimited")),1))]),_:1})]),De,e("div",Ye,[I(E,{visible:!0,onClear:l[12]||(l[12]=n=>F.value=1/0)},{default:C(()=>[o(F)!==1/0?L((k(),j("input",{key:0,"onUpdate:modelValue":l[10]||(l[10]=n=>Y(F)?F.value=n:null),type:"number",class:"max-w-50px bg-transparent focus:border-none focus:outline-none text-right py-1",inputmode:"decimal"},null,512)),[[A,o(F)]]):(k(),j("div",{key:1,class:"py-1",onClick:l[11]||(l[11]=n=>F.value=0)},r(i.$t("unlimited")),1))]),_:1})])])]),e("div",Re,[e("div",Ee,[ze,e("div",Ne,r(i.$t("users"))+":",1)]),e("div",qe,[I(O,{modelValue:o(w),"onUpdate:modelValue":l[13]||(l[13]=n=>Y(w)?w.value=n:null),list:o(D),multiple:"","value-key":"id"},{default:C(({allSelected:n})=>[e("div",Te,r(n?i.$t("all"):o(w).length===0?"None":o(w).map(U=>U.name).join(",")),1)]),_:1},8,["modelValue","list"])])]),e("div",He,[e("div",Le,[Ae,e("div",Ke,r(i.$t("categories"))+":",1)]),e("div",Ge,[I(O,{modelValue:o(g),"onUpdate:modelValue":l[14]||(l[14]=n=>Y(g)?g.value=n:null),list:o(a),multiple:"","value-key":"id"},{default:C(({allSelected:n})=>[e("div",Je,r(n?i.$t("all"):o(g).length===0?i.$t("none"):o(g).map(U=>i.$t(U.name)).join(",")),1)]),option:C(({item:n,selected:U,select:N})=>[e("div",{class:S(["p-2 buttoned flex items-center",{"!bg-gray-700 text-white":U}])},[e("div",Oe,[e("i",{class:S([n.icon])},null,2)]),e("div",Pe,r(i.$t(n.name)),1)],2)]),_:1},8,["modelValue","list"])])])],2),e("div",{class:S(["flex justify-between py-2",{"border-t":y.value}])},[e("div",null,[e("div",{class:S(["buttoned rounded-sm px-2 text-gray-600",{"opacity-0 pointer-events-none":!y.value}]),onClick:l[15]||(l[15]=(...n)=>o(s)&&o(s)(...n))},r(i.$t("reset")),3)]),e("div",{class:"flex items-center rounded-sm buttoned px-2",onClick:l[16]||(l[16]=()=>$())},[Qe,e("div",We,r(i.$t("filter")),1)])],2)]))}});const Ze=ee(Xe,[["__scopeId","data-v-ca4c50d6"]]),et=()=>{const t=x(`comp_${J()}`);return{key:t,reload:()=>{t.value=`comp_${J()}`}}},tt={class:"w-full h-full flex justify-center p-2"},st={class:"h-full w-full mx-2 max-w-[600px] flex flex-col"},lt={class:"search w-full flex justify-center pt-4"},it={class:"w-full h-10 shadow-md rounded-sm flex items-center px-4 focus-within:shadow-lg"},nt={class:"flex-1"},ot=e("i",{class:"icon-search"},null,-1),at=[ot],dt={class:"flex-1 flex flex-col overflow-hidden"},ut={class:"flex items-center justify-between px-2"},ct={class:"text-sm text-gray-500"},rt={key:0,class:"icon-sort-az opacity-40"},vt={key:1,class:"icon-sort-za"},mt={key:2,class:"icon-sort-az"},ft={class:"flex-1 divide-y overflow-y-auto"},Ft=K({__name:"SearchView",setup(t){const{list:_}=de(),v=x(""),f=x([]),y=ne(),$=()=>y.query.filters?JSON.parse(y.query.filters):void 0,p=x(),b=[void 0,"asc","desc"],u=x(),V=()=>{const a=b.findIndex(d=>d===u.value),c=a+1>=b.length?0:a+1;u.value=b[c]},B=Z(()=>u.value===void 0?f.value:ve(f.value,["money"],[u.value])),{key:F,reload:M}=et(),w=()=>{var d;const a=(d=p.value)==null?void 0:d.getFilter();if(!a){f.value=[];return}const c=a;M(),f.value=_.value.filter(s=>ae(s,{...c,comment:v.value}))};se(()=>{var c,d;const a=$();a&&((c=p.value)==null||c.setFilter(a),(d=p.value)==null||d.toggleExpand(!0),w())});const g=(a,c)=>{const m=Math.min(f.value.length,a+c)-a;return 72*m},{show:D}=ue();return(a,c)=>(k(),j("div",tt,[e("div",st,[e("div",lt,[e("div",it,[e("div",nt,[I(E,{visible:v.value.length>0,onClear:c[1]||(c[1]=d=>v.value="")},{default:C(()=>[L(e("input",{"onUpdate:modelValue":c[0]||(c[0]=d=>v.value=d),type:"text",class:"w-full bg-transparent focus:border-none focus:outline-none"},null,512),[[A,v.value]])]),_:1},8,["visible"])]),e("div",{class:"buttoned p-3 rounded-full",onClick:w},at)])]),e("div",dt,[I(Ze,{ref_key:"filterRef",ref:p},null,512),e("div",ut,[e("div",ct,r(a.$t("total"))+": "+r(o(B).length),1),e("div",{onClick:V,class:"px-4 py-2 buttoned rounded-full"},[u.value===void 0?(k(),j("div",rt)):u.value==="asc"?(k(),j("div",vt)):u.value==="desc"?(k(),j("div",mt)):le("",!0)])]),e("div",ft,[(k(),ie(ce,{key:o(F),list:o(B),"value-key":"id","get-range-height":g,"footer-height":96},{default:C(({item:d})=>[I(re,{bill:d,onClick:s=>o(D)(d)},null,8,["bill","onClick"])]),_:1},8,["list"]))])])])]))}});export{Ft as default};
